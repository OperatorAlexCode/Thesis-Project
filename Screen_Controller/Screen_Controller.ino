#include <Arduino.h>
#include <U8g2lib.h>
#include <vector>
#include "TCA9548A.h"
#include <Wire.h>

U8G2_SH1107_SEEED_128X128_F_HW_I2C Screen1(U8G2_R1, /* reset=*/ U8X8_PIN_NONE);
U8G2_SH1107_SEEED_128X128_F_HW_I2C Screen2(U8G2_R1, /* reset=*/ U8X8_PIN_NONE);

const uint8_t testIcon[] = {
  0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 
  0x0F, 0x0F, 0x0F, 0x0F, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 
  0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x0F, 0x0F, 0x0F, 0x0F, 
  0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 
  0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 
  0xF0, 0xF0, 0xF0, 0xF0, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 
  0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xF0, 0xF0, 0xF0, 0xF0, 
  0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 
  0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 
  0x0F, 0x0F, 0x0F, 0x0F, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 
  0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
};

TCA9548A TCA;

void setup() {
  // put your setup code here, to run once:
  
  Serial.begin(9600);
  while (!Serial);

  TCA.begin(Wire);
  Screen1.begin();
  Screen1.setFont(u8g2_font_7x14B_tr);

  /*TCA.openAll();
  Screen.clearBuffer();
  Screen.sendBuffer();
  TCA.closeAll();*/

  Clear();
}

void loop() {
  // put your main code here, to run repeatedly:

  for (int x = 0; x < 8; x++) {
    TCA.openChannel(x);

    String output = String("Screen ") + String(x);

    Screen1.clearBuffer();
    Screen1.drawStr(0, 10, output.c_str());
    Screen1.sendBuffer();

    TCA.closeChannel(x);
  }

  TCA.openAll();

  delay(300);

  TCA.closeAll();

  for (int x = 0; x < 8; x++) {
    TCA.openChannel(x);

    String output = String("Screen ");

    Screen1.clearBuffer();
    Screen1.drawStr(0, 10, output.c_str());
    Screen1.sendBuffer();

    TCA.closeChannel(x);
  }

  TCA.openAll();

  delay(300);

  TCA.closeAll();
}

void Clear() {
  TCA.openAll();

  //TCA.openChannel(TCA_CHANNEL_0);
  //TCA.openChannel(TCA_CHANNEL_1);
  //TCA.openChannel(TCA_CHANNEL_2);

  /*Screen1.clearBuffer();
  Screen1.drawXBMP(0, 0, 32, 32, testIcon);
  Screen1.sendBuffer();*/

  Screen1.clearDisplay();

  TCA.closeAll();
}